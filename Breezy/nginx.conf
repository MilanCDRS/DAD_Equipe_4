events { worker_connections 1024; }

http {
  server {
    listen 80;
    server_name localhost;

  # Pour l'inscription
    location /register {
      proxy_pass http://auth:3000/api/auth/register;   # ← note le /api/auth/register
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
    }

  # Pour la connexion
    location /login {
      proxy_pass http://auth:3000/api/auth/login;      # ← et ici aussi /api/auth/login
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
    }

    ## Authentification interne (pas accessible depuis l’extérieur)
    location = /authenticate {
      internal;
      proxy_pass http://auth:3000/authenticate;
      proxy_pass_request_body off;
      proxy_set_header Content-Length "";
      proxy_set_header Authorization $http_authorization;
    }

    ## Service public (ouvert)
    location /public/ {
      proxy_pass http://public:3000/;
    }

    ## Service privé (protégé)
    location /private/ {
      auth_request /authenticate;       # ← uniquement ici
      proxy_pass http://private:3000/;
    }
  }
}
